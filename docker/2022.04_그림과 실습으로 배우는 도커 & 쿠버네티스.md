> 해당 글은 [그림과 실습으로 배우는 도커 & 쿠버네티스](https://wikibook.co.kr/dkkb/)를 보고 정리한 내용 입니다.
 
> ⚠️ 해당 글은 2024년 1월 10일부터 작성되었습니다.

<img src="../assets/book/2022_그림과 실습으로 배우는 도커 & 쿠버네티스.jfif" width="200"/>

# ▣ 1장: 도커란 무엇인가?
## 01 도커란 무엇인가?
- 도커는 `데이터 또는 프로그램을 격리시키는` 기능을 제공는 소프트웨어
  - 주로 서버에 사용
- `컨테이너`: PC 또는 서버 상의 환경을 독립되게 분할하는 조립형 창고
- `도커`: 컨테이너 기능을 제공하는 소프트웨어
  - 도커를 사용하여면 도커 엔진을 설치해야 함
- 컨테이너를 만들려면 이미지가 필요
- 담고 있는 소프트웨어의 종류에 따라 다양한 이미지를 사용
  - 예) MySQL 컨테이너를 만들려면 MySQL 이미지 필요
- 컨테이너는 여러개 만들 수 있음
- 리눅스 운영체제 필요 ➡️ 리눅스 운영체제에서 사용하는 것을 전제
  - 윈도우나 macOS에서도 구동되나 `내부적으로 리눅스가 사용`
  - `컨테이너에서 동작시킬 프로그램도 리눅스용 프로그램`

<img src="img/dkkb_01.png" width="500"/>

<em>출처:[ksu9704.log](https://velog.io/@ksu9704/Docker-tqjxw39x)</em> 

- 데이터나 프로그램을 독립된 환경에 격리해야 하는 이유?
  - 대부분의 프로그램은 단독으로 동작하는 것이 아니라 어떤 실행 환경이나 라이브러리, 다른 프로그램등을 이용해 동작
  - 다른 프로그램과 특정 폴더와 디렉토리 공유하거나 같은 경로에 설정 정보를 저장하는 경우도 있음 ➡️ 서로 영향을 주고 받을 수 있음
  - 특정 프로그램 업데이트시 다른 프로그램이 영향 받을 수도 있음

<img src="img/dkkb_02.png" width="500"/>

<em>출처:[ksu9704.log](https://velog.io/@ksu9704/Docker-tqjxw39x)</em> 

- 컨테이너 안에 들어있는 프로그램은 다른 프로그램과 격리된 상태
  - 독립된 환경이므로 여러 컨테이너에서 같은 프로그램을 실행할 수 있음

<img src="img/dkkb_03.png" width="500"/>

<em>출처:[ksu9704.log](https://velog.io/@ksu9704/Docker-tqjxw39x)</em> 

## 02 서버와 도커
- 서버는 `어떤 서비스(service)를 제공(Serve)하는 것`
  - 기능적 의미의 서버: ex) 웹 기능 제공 서버, 이메일 기능 제공 서버 
  - 물리적 의미의 서버: 실물로 존재하는 장치
- 도커는 하나의 물리적 서버에 여러 개의 논리적 서버를 둘 수 있게 해줌 
- 서버의 운영체제는 주로 `리눅스`가 사용
- 컨테이너를 이용해 여러 가지 서버 기능을 안전하게 함께 실행 가능
  - 물리적 서버 수 감소 ➡️ 비용 감소
- 컨테이너는 자유로이 옮길 수 있음
  - 정확히는 컨테이너의 정보를 내보내기한 다음  ➡️ 다른 도커엔진에서 복원
- 도커는 물리적 환경의 차이, 서버 구성의 차이를 무시하게 해줌 
 
# ▣ 2장: 도커의 동작 원리
## 01 도커의 동작 원리
- 운영체제 위에 도커 엔진이 동작하고 그 위에서 컨테이너가 동작
- 모든 컨테이너에는 `리눅스 운영체제 비슷한 무언가`가 들어 있음
- 도커 엔진 아래에도 리눅스 운영 체제가 있는데, 컨테이너 속에 또 리눅스 운영체제(비슷한 것)가 있음
  - 컨테이너 속에 운영체제의 주변 부분이 들어 있어 프로그램의 명령을 전달받고 이를 밑바탕이 되는 커널에 전달하는 구조
  - 즉, 주변 부분만 컨테이너에 넣고, 커널은 및바탕에 빌려 쓰기 ➡️ `가벼움` 
- 도커는 기본적으로 `리눅스용`이다


<img src="img/dkkb_04.png" width="600"/>

<em>출처: [https://gayuna.github.io/](https://gayuna.github.io/docker/docker/)</em> 

## 02 도커 허브와 이미지, 그리고 컨테이너
- 이미지는 컨테이너를 만드는데 사용
  - 실제로 사용하는 것은 컨테이너, 이미지를 그대로 사용하는 일은 없음
- 컨테이너로도 이미지를 만들 수 있음
  - 개조된 컨테이너로 부터 새롭게 만든 이미지를 사용해 개조된 컨테이너를 대량으로 만들 수 있음

<img src="img/dkkb_05.png" width="600"/>

<em>출처: [https://ryu-e.tistory.com/10](https://ryu-e.tistory.com/10)</em> 

- 다른 물리 서버에 설치된 도커 엔진으로 컨테이너를 이동시킬 수 있음
- [도커 허브](https://hub.docker.com/)를 통해 다양한 이미지를 이용할 수 있음
  - 공개된 컨테이너 이미지가 모여 있는 곳 ➡️ 다운로드 가능
  - 운영체제, 소프트웨어 포함된 이미지, 변종(배포판, 버전 등) 이미지 등 제공
- 안전한 컨테이너 이미지를 고르는 팁
  - 공식 이미지 사용
    - 도커에서 직접 배포 or 해당 SW 개발/관리 조직에서 제공
    - 보안 문제 해결
  - 커스텀 이미지를 직접 만들어 사용
- 컨테이너는 다양한 형태로 조합 가능
  - 기본원칙: `한 컨테이너에 하나의 프로그램` -> `보안`에 유리 
  - 물론 한 컨테이너에 프로그램을 모두 집어넣어도 됨 -> `유지 보수 어려움`- 


## 03 도커 컨테이너의 생애주기와 데이터 저장
- 도커 컨테이너는 `쓰고 버리는` 일회용품
  - 새로운 버전이 나오면 새로운 컨테이너로 갈아타기 권장 -> 유지 보수가 용이 
- **컨테이어의 생애주기**: `만들고`, `실행하고`, `종료하고`, `폐기한` 다음 새로운 컨테이너를 `만드는` 일련의 과정
- 컨테이너를 폐기하면 그속의 데이터는 함께 폐기 -> 이를 방지하기 위해 `도커가 설치된 물리적 서버(호스트)의 디스크를 마운트`해 이를 저장
  - [참고] 도커는 볼륨과 바인드 마운트 2종의 데이터 저장 방식 제공

  <img src="img/dkkb_06.png" width="500"/>

  <em>출처: [kjw8370.log](https://velog.io/@kjw8370/%EB%8F%84%EC%BB%A4%EC%9D%98-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC)</em> 


## 04 도커의 장점과 단점

- 도커의 구조와 성질
  - 독립된 환경: 여러 개 컨테이너 띄울 수 있으며, 교체 수정 가능
  - 이미지를 만들 수 있다: 내려받기만 하면 컨테이너 사용가능, 교체와 업데이트 쉽다. 개발 환경 구축이 용이
  - 컨테이너에 `커널을 포함시킬 필요가 없다`
    - 가볍다  

  <img src="img/dkkb_07.png" width="800"/>

  <em>출처: [kjw8370.log](https://velog.io/@kjw8370/%EB%8F%84%EC%BB%A4%EC%9D%98-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC)</em> 

- 도커의 장점
  - 한 대의 물리 서버에 여러 대의 서버를 띄울 수 있음
  - 서버 관리가 용이
  - 서버를 잘 몰라도 다루기 쉽다
- 도커의 단점
  - 리눅스용 소프트웨어 밖에 지원하지 않는다.
  - 호스트 서버에 문제가 생기면 모든 컨테이너에 영향이 미친다.
  - 컨테이너 하나를 장기간에 걸쳐 사용할 때는 큰 장점을 느끼기 어렵다.
- 도커의 주 용도
  - 팀원 모두에게 동일한 개발환경 제공 (=동일한 환경 여러개 만들기)
  - 새로운 버전의 테스트 (=격리된 환경을 이용)
  - 동일한 서버가 여러 대 필요한 경우 (=컨테이너 밖과 독립된 성질을 이용)

 
# ▣ 3장: 도커를 사용해보자
## 01 도커를 사용하려면
- 도커 환경 구축 세 가지 방법
  - 리눅스 컴푸터에서 도커 사용하기
  - 가상 머신이나 렌탈 환경에 도커를 설치하고 윈도우나 macOS를 통해 사용하기
  - 윈도우용/macOS용 도커 사용하기
- 윈도우/macOS에서는 리눅스 운영체제가 들어있는 패키지(도커 데스크톱)을 사용
- 윈도우에서는 Hyper-V(윈도우용 가상환경)가 활성 상태이어야 함
- 도커를 실행하기 위한 조건
  - 64비트 운영체제
  - 우분투 16.04 이후

## 02 도커 설치
- [도커 설치 문서 참조](https://github.com/spiders22v/TIL/blob/main/docker/02_%EB%8F%84%EC%BB%A4%20%EC%84%A4%EC%B9%98.md)


## 03 도커의 조작 방법과 명령 프롬프트 및 터미널 실행
- 생략
 
# ▣ 4장: 컨테이너를 실행해 보자
## 01 도커 엔진 시작하기/종료하기
- 윈도우 & macOS
  - 도커 엔진 시작: 도커 데스크탑 실행
  - 자동실행: 메뉴에서 "Start Docker Desktop when you log in" 체크
- 리눅스
  ```bash
  $ sudo systemctl start docker     # 도커 엔진 시작
  $ sudo systemctl stop docker      # 도커 엔진 종료
  $ sudo systemctl enable docker    # 자동 실행 설정
  ```

## 02 컨테이너의 기본적인 사용 방법
- 도커 명령어와 대상
  - 컨테이너를 다루는 모든 명령은 `docker` 명령어로 시작
  - docker 명령어 뒤에 오는 '무엇을', '어떻게'에 해당하는 부분을 `커맨드`라고 함
  - 커맨드는 다시 `상위 커맨드`와 `하위 커맨드`로 구성되며 상위 커맨드가 `무엇을`, 하위 커맨드가 `어떻게`에 해당하는 내용을 지정
  - `대상`에는 컨테이너명 또는 이미지명 등 구체적인 이름 사용
  - docker 명령어 뒤로 `무엇을` `어떻게` `대상` 순으로 지정
  ```bash
  $ docker + 커맨드 + 대상     # 커맨드는 상위 커맨드와 하위 커맨드로 구성
  ```

- 옵션과 인자
  - 커맨드에는 `대상` 외에도 `옵션`과 `인자`라는 추가 정보가 붙을 수 있음
  - 예를 들어, container run 커맨드에 -d 라는 옵션을, penguin 을 대상으로 --mode=1 이라는 인자를 붙이면, ```$ docker container run -d penguin --mode=1``` 이라는 명령어가 완성
  - `-d` 는 '백그라운드로 실행하라', `--mode=1` 은 '모드 1로 실행하라' 라는 의미지만, 모든 명령어에 옵션이나 인자가 붙는 것은 아니며 커맨드와 대상만으로 구성된 간단한 명령어도 많음


- 기본적인 명령어 (정리)
```bash
$ docker 커맨드 (옵션) 대상 (인자)    # docker 명령어의 기본적인 형태
```
  - 커맨드: '무엇을' '어떻게' 할 것인지 지정하는 부분
    - ex) '컨테이너'를 '실행' 하고 싶다면, `container run` 커맨드를 사용한다.
  - 옵션
  - 대상
  - 인자   

https://velog.io/@sorzzzzy/Docker-4.-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88%EC%9D%98-%EA%B8%B0%EB%B3%B8%EC%A0%81%EC%9D%B8-%EC%82%AC%EC%9A%A9-%EB%B0%A9%EB%B2%95

- 대표적인 명령어

  <img src="img/dkkb_08.jfif" width="600"/>


컨테이너 사용의 기본은 도커 명령어
기본적인 명령어 – 정리
[실습] 간단한 명령어를 사용해 보자


## 03 컨테이너의 생성과 삭제, 실행, 정지
docker run 커맨드와 docker stop, docker rm 커맨드
docker ps 커맨드
[실습] 컨테이너를 생성하고, 실행, 상태 확인, 종료, 삭제해 보자
04 컨테이너의 통신
아파치란?
컨테이너와 통신하려면
[실습] 통신이 가능한 컨테이너 생성
05 컨테이너 생성에 익숙해지기
다양한 유형의 컨테이너
[실습] 아파치 컨테이너를 여러 개 실행하기
[실습] Nginx 컨테이너 실행하기
[실습] MySQL 컨테이너 실행하기
06 이미지 삭제
이미지 삭제
docker image rm 커맨드
docker image ls 커맨드
[실습] 이미지 삭제하기
 
# ▣ 5장: 여러 개의 컨테이너를 연동해 실행해보자
01 워드프레스 구축
워드프레스 사이트 구성 및 구축
도커 네트워크 생성/삭제
MySQL 컨테이너 실행 시에 필요한 옵션과 인자
워드프레스 컨테이너 실행 시 필요한 옵션과 인자
02 워드프레스 및 MySQL 컨테이너 생성과 연동
이번 절의 실습 내용과 사용할 커맨드
워드프레스와 MySQL 컨테이너 생성 및 실행
03 명령어를 직접 작성하자
소프트웨어와 데이터베이스의 관계
run 커맨드를 직접 작성하는 방법
04 레드마인 및 MariaDB 컨테이너를 대상으로 연습하자
레드마인 및 MySQL 컨테이너 생성
레드마인 및 MariaDB 컨테이너 만들기
 
# ▣ 6장: 실전에 활용 가능한 컨테이너 사용법을 익히자
01 내게 필요한 지식이 무엇인지 정리하기
자신의 역할에 따라 알아야 할 지식이 달라진다
앞으로 설명할 도커 기술
02 컨테이너와 호스트 간에 파일 복사하기
파일 복사
[실습] 호스트의 파일을 컨테이너 속으로 복사
[실습] 컨테이너의 파일을 호스트로 복사
03 볼륨 마운트
볼륨과 마운트
스토리지 마운트의 종류
스토리지 영역을 마운트하는 커맨드
[실습] 바인드 마운트해보기
[실습] 응용편 – 볼륨 마운트해보기
04 컨테이너로 이미지 만들기
컨테이너로 이미지를 만드는 방법
[실습] commit 커맨드로 컨테이너를 이미지로 변환
[실습] Dockerfile 스크립트로 이미지 만들기
05 컨테이너 개조
컨테이너의 개조란?
도커의 구조, 도커 엔진을 통해야 하는 명령과 컨테이너 안에서 실행해야 하는 명령
06 도커 허브 등록 및 로그인
이미지는 어디서 내려받는 걸까?
도커 허브와 도커 레지스트리
태그와 이미지 업로드
레지스트리를 만드는 방법
 
# ▣ 7장: 도커 컴포즈를 익히자
01 도커 컴포즈란?
도커 컴포즈란?
02 도커 컴포즈의 설치와 사용법
[실습] 도커 컴포즈 설치
도커 컴포즈의 사용법
03 도커 컴포즈 파일을 작성하는 법
도커 컴포즈 정의 파일의 내용 살펴보기
컴포즈 파일(정의 파일)을 작성하는 방법
[실습] 컴포즈 파일 작성
04 도커 컴포즈 실행
도커 컴포즈 커맨드
[실습] 도커 컴포즈 실행
 
# ▣ 8장: 쿠버네티스를 익히자
01 쿠버네티스란?
쿠버네티스란?
02 마스터 노드와 워커 노드
클러스터의 구성 – 마스터 노드와 워커 노드
쿠버네티스는 항상 ‘바람직한’ 상태를 유지한다
03 쿠버네티스의 구성과 관련 용어
쿠버네티스의 구성과 관련된 용어(파드, 서비스, 디플로이먼트, 레플리카세트)
그 밖의 쿠버네티스 리소스
04 쿠버네티스 설치 및 사용법
쿠버네티스의 종류
어떤 종류의 쿠버네티스를 사용할까?
[실습] 도커 데스크톱의 쿠버네티스 준비
05 매니페스트 파일(정의 파일) 작성
매니페스트 파일이란?
매니페스트 파일로 작성할 내용
메타데이터와 스펙 작성(1) – 파드
[실습] 매니페스트 파일 작성(1) – 파드
메타데이터와 스펙 작성(2) – 디플로이먼트
[실습] 매니페스트 파일(정의 파일) 작성(2) – 디플로이먼트
메타데이터와 스펙 작성(3) – 서비스
[실습] 매니페스트 파일 작성(3) – 서비스
06 쿠버네티스 명령어
쿠버네티스 명령어
[실습] 매니페스트 파일로 파드 생성(1) – 디플로이먼트
[실습] 매니페스트 파일로 파드 생성(2) – 서비스
07 쿠버네티스를 연습하자
[실습] 매니페스트 파일로 파드의 개수 늘리기
[실습] 매니페스트 파일로 아파치를 nginx로 바꾸기
[실습] 수동으로 파드를 삭제한 후 자동복구되는지 확인
[실습] 생성했던 디플로이먼트와 서비스 삭제
저자 후기
 
# ▣ 부록
01 (윈도우용) 설치 관련 정보
[실습] 윈도우의 32비트/64비트 여부 및 버전 확인
02 (macOS용) 도커 데스크톱 설치 방법
[실습] macOS에서 도커 데스크톱 설치
03 (리눅스용) 도커 설치
[실습] 리눅스 설치
[실습] 도커 설치
04 VirtualBox의 포트 포워딩 설정
05 (리눅스용) nano 에디터의 사용법
06 (리눅스용) 쿠버네티스 설치
[실습] kubectl 설치
[실습] Minikube 설치
07 도커 데스크톱 콘솔의 사용법
08 도커 커맨드
09 VirtualBox를 이용한 실습 준비
[실습] VirtualBox 실습 준비(1) - VirtualBox 설치
[실습] VirtualBox 실습 준비(2) - 가상 머신 만들기
[실습] VirtualBox 실습 준비(3) – ISO 이미지 마운트 및 미세 조정
[실습] VirtualBox 실습 준비(4) – 리눅스(우분투) 설치
10 AWS를 이용한 실습 준비
[실습] AWS 가상 머신에 우분투 설치
[실습] SSH로 EC2 인스턴스에 접속